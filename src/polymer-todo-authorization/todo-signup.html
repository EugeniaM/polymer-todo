<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="todo-signup">
  <template>
    <style>
      :host {
        display: block;
      }

      .signup-container {
        width: 600px;
        height: 300px;
        padding: 25px;
      }

      paper-input {
        --paper-input-container-focus-color: var(--paper-teal-500);
      }

      iron-icon {
        color: var(--paper-teal-500);
      }

      .back-btn {
        color: var(--paper-teal-500);
        font-weight: 600;
        cursor: pointer;
      }

      paper-button {
        background: var(--paper-teal-500);
        color: #fff;
        font-weight: 600;
      }

      paper-button:hover {
        background: var(--paper-teal-800);
      }

      .btn-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 15px 0;
      }

      .error {
        color: var(    --paper-red-700);
      }
    </style>

    <firebase-auth
      id="auth"
      user="{{user}}">
    </firebase-auth>

    <paper-card>
      <div class="signup-container">
        <div class="back-btn" on-click="navigateBack">
          <iron-icon icon="icons:arrow-back"></iron-icon>
          BACK
        </div>
        <h2>Please Sign Up</h2>
        <paper-input type="email" label="Email" value="{{email}}"></paper-input>
        <paper-input type="password" label="Password" value="{{password}}"></paper-input>

        <template is="dom-if" if="[[error.value]]">
          <div class="error">[[error.message]]</div>
        </template>

        <div class="btn-container">
          <paper-button raised on-tap="signUp">SIGN UP</paper-button>
        </div>
      </div>
    </paper-card>
  </template>

  <script>
    class TodoSignup extends Polymer.Element {
      static get is() { return 'todo-signup'; }
      static get properties() {
        return {
          page: {
            type: String,
            value: '',
            notify: true
          },
          email: {
            type: String,
            value: ''
          },
          password: {
            type: String,
            value: ''
          },
          error: {
            type: Object,
            value() { return {}; }
          },
          user: {
            type: Object,
            notify: true,
            value: false
          },
        }
      }

      navigateBack() {
        this.set('page', '');
      }

      signUp() {
        if (!this.email || !this.password) {
          this.set('error.value', true);
          this.set('error.message', 'Email or Password is invalid');
          return;
        }

        this.$.auth.createUserWithEmailAndPassword(this.email, this.password)
          .then((user) => {
            firebase.database().ref(`Users/${user.uid}`).set({
              email: user.email
            }, () => {
              const event = new CustomEvent('do-redirect', {
                bubbles: true, composed: true,
                detail: { page: '/' }
              });
              this.dispatchEvent(event);
            });
          })
          .catch((err) => {
            this.set('error.value', true);
            this.set('error.message', err.message);
          });
      }
    }

    window.customElements.define(TodoSignup.is, TodoSignup);
  </script>
</dom-module>
